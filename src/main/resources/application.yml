spring:
  application:
    name: system-service

  main:
    allow-bean-definition-overriding: true
    web-application-type: reactive

  datasource:
    url: jdbc:mysql://localhost:3306/tgs-system?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh&createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true
    username: root
    password:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true

  # Disable auto-configuration for testing
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration

  flyway:
    enabled: false

  # ===================== MAIL CONFIGURATION =====================
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    from-name: ${MAIL_FROM_NAME:HDDT System}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
          connectiontimeout: 5000
          timeout: 3000
          writetimeout: 5000


  jackson:
#    serialization:
#      write-dates-as-timestamps: false
    default-property-inclusion: non_null
    time-zone: Asia/Ho_Chi_Minh

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=30m

# ===================== SECURITY (Common Service) =====================
security:
  jwt:
    enabled: true
    secret: ${JWT_SECRET:THIS_IS_A_32_BYTE_SECRET_KEY_FOR_JWT_2026}
    issuer: system-service
    expiration-seconds: 3600
    refresh-expiration-seconds: 604800

# ===================== LOGGING (Common Service) =====================
common:
  logging:
    enabled: true
    request:
      enabled: true
      include-headers: true
      include-body: false
    response:
      enabled: true
      include-body: false
    trace:
      enabled: true
      header-name: X-Trace-Id

# ===================== APPLICATION CONFIG =====================
app:
  base-url: ${APP_BASE_URL:http://localhost:8081}
  
  security:
    max-failed-login-attempts: 5
    account-lock-duration-minutes: 30
    password-min-length: 8
    password-require-uppercase: true
    password-require-lowercase: true
    password-require-digit: true
    password-require-special: false

  audit:
    enabled: true
    async: true
    include-request-body: true
    include-response-body: false
    max-body-length: 2048

  token:
    cleanup-enabled: true
    cleanup-cron: "0 0 2 * * ?"
    expired-token-retention-days: 7

  # Email notification settings
  notification:
    email:
      enabled: ${EMAIL_NOTIFICATION_ENABLED:true}
      welcome-enabled: ${WELCOME_EMAIL_ENABLED:true}
      login-notification-enabled: ${LOGIN_NOTIFICATION_ENABLED:false}
      password-reset-enabled: ${PASSWORD_RESET_EMAIL_ENABLED:true}
      password-changed-enabled: ${PASSWORD_CHANGED_EMAIL_ENABLED:true}

# ===================== SERVER =====================
server:
  port: 8081
  servlet:
    context-path: /
  compression:
    enabled: true
#  error:
#    include-message: always
#    include-binding-errors: always

# ===================== LOGGING =====================
logging:
  level:
    root: INFO
    com.hddt.system: DEBUG
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/system-service.log
    max-size: 10MB
    max-history: 30

# ===================== MANAGEMENT =====================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
